# 🎄 交換禮物系統測試指南

## 修正內容

### ✅ 已修正的問題

1. **後台無法載入活動列表**
   - 修正 `api/status.js` 的資料格式處理
   - 正確處理陣列（未抽籤）和物件（已抽籤）兩種資料格式
   - 管理員模式現在可以正確列出所有活動

2. **組別成員名單功能**
   - 可以在建立活動時設定 `members` 陣列
   - 前台和後台都會顯示組別成員名單

3. **CSS 美化**
   - 後台管理介面：現代化設計，紫色漸層背景
   - 前台使用者介面：聖誕主題，雪花動畫
   - 測試頁面：清爽的卡片式設計

## 測試步驟

### 1. 測試建立活動

訪問測試頁面：
```
http://localhost:3000/test
或
https://your-domain.vercel.app/test
```

1. 輸入管理密碼（環境變數 `ADMIN_SECRET`）
2. 填寫活動資訊
3. 使用以下組別設定範例：

```json
[
  { "id": 1, "name": "光佑", "limit": 1, "members": ["光佑"] },
  { "id": 2, "name": "Jefferson", "limit": 1, "members": ["Jefferson"] },
  { "id": 3, "name": "PJ一家", "limit": 2, "members": ["PJ", "PJ太太"] }
]
```

4. 點擊「🎁 建立活動」
5. 複製產生的活動連結

### 2. 測試前台使用者介面

1. 使用上一步產生的連結訪問前台
2. 應該會看到：
   - 活動名稱
   - 組別選項（包含成員名單）
   - 例如：`PJ一家 [PJ, PJ太太] (0/2)`
3. 填寫表單並提交
4. 檢查進度更新

### 3. 測試後台管理介面

訪問後台：
```
http://localhost:3000/admin
或
https://your-domain.vercel.app/admin
```

1. 輸入管理密碼
2. 應該會看到活動列表
3. 點擊「管理」按鈕進入活動詳情
4. 檢查參與者列表
5. 測試抽籤功能（人數到齊後）
6. 測試寄送通知信功能

## 組別設定說明

### 基本格式

```json
{
  "id": 1,              // 組別 ID（必須從 1 開始連續）
  "name": "組別名稱",    // 組別顯示名稱
  "limit": 2,           // 該組別的人數限制
  "members": ["成員1", "成員2"]  // 組別成員名單（可選）
}
```

### 範例

**單人組別：**
```json
{ "id": 1, "name": "光佑", "limit": 1, "members": ["光佑"] }
```

**家庭組別：**
```json
{ "id": 2, "name": "PJ一家", "limit": 3, "members": ["PJ", "PJ太太", "PJ小孩"] }
```

**不指定成員：**
```json
{ "id": 3, "name": "朋友組", "limit": 5, "members": [] }
```

## 環境變數檢查

確保以下環境變數已設定：

```env
ADMIN_SECRET=你的管理密碼
GMAIL_USER=你的Gmail帳號
GMAIL_APP_PASSWORD=Gmail應用程式密碼
KV_REST_API_URL=Vercel KV URL
KV_REST_API_TOKEN=Vercel KV Token
```

## 常見問題

### Q: 後台顯示「無法載入活動列表」
A: 檢查是否正確輸入管理密碼，密碼必須與 `ADMIN_SECRET` 環境變數一致

### Q: 前台無法顯示組別成員
A: 確保在建立活動時有填寫 `members` 陣列

### Q: 抽籤按鈕無法點擊
A: 必須等所有組別的人數都到齊才能執行抽籤

### Q: 無法寄送通知信
A: 檢查 Gmail 相關環境變數是否正確設定

## 檔案結構

```
├── api/
│   ├── create-event.js      # 建立活動
│   ├── status.js            # 查詢狀態（支援管理員和前台）
│   ├── submit.js            # 提交願望
│   ├── draw.js              # 執行抽籤
│   ├── send-emails.js       # 寄送通知信
│   ├── delete-event.js      # 刪除活動
│   ├── delete-user.js       # 刪除參與者
│   ├── reset.js             # 重置活動
│   └── get-event-config.js  # 取得活動設定
├── index.html               # 前台使用者介面
├── admin.html               # 後台管理介面
├── test-create-event.html   # 測試建立活動頁面
└── vercel.json              # Vercel 路由配置
```
