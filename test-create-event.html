<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ¸¬è©¦å»ºç«‹æ´»å‹•</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input, textarea { width: 100%; padding: 8px; box-sizing: border-box; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>æ¸¬è©¦å»ºç«‹æ´»å‹•åŠŸèƒ½</h1>
    
    <div class="form-group">
        <label>ç®¡ç†å¯†ç¢¼:</label>
        <input type="password" id="adminSecret" placeholder="è¼¸å…¥ ADMIN_SECRET">
    </div>

    <div class="form-group">
        <label>æ´»å‹•åç¨±:</label>
        <input type="text" id="eventName" value="2025 æ¸¬è©¦äº¤æ›ç¦®ç‰©">
    </div>

    <div class="form-group">
        <label>ç¦®ç‰©é‡‘é¡:</label>
        <input type="text" id="giftAmount" value="$500 - $700">
    </div>

    <div class="form-group">
        <label>çµ„åˆ¥è¨­å®š (JSON):</label>
        <textarea id="groupsConfig" rows="10">[
  { "id": 1, "name": "å…‰ä½‘", "limit": 1, "members": ["å…‰ä½‘"] },
  { "id": 2, "name": "Jefferson", "limit": 1, "members": ["Jefferson"] },
  { "id": 3, "name": "PJä¸€å®¶", "limit": 2, "members": ["PJ", "PJå¤ªå¤ª"] }
]</textarea>
    </div>

    <button onclick="createEvent()">å»ºç«‹æ´»å‹•</button>
    <button onclick="listEvents()">åˆ—å‡ºæ‰€æœ‰æ´»å‹•</button>

    <div id="result" class="result" style="display:none;"></div>

    <script>
        async function createEvent() {
            const secret = document.getElementById('adminSecret').value;
            const eventName = document.getElementById('eventName').value;
            const giftAmount = document.getElementById('giftAmount').value;
            const groupsConfig = document.getElementById('groupsConfig').value;

            try {
                const groups = JSON.parse(groupsConfig);
                
                const response = await fetch('/api/create-event', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${secret}`
                    },
                    body: JSON.stringify({ eventName, giftAmount, groups })
                });

                const result = await response.json();
                const resultDiv = document.getElementById('result');
                resultDiv.style.display = 'block';
                
                if (response.ok) {
                    resultDiv.innerHTML = `<h3>âœ… æˆåŠŸï¼</h3>
                        <p><strong>æ´»å‹• ID:</strong> ${result.event.id}</p>
                        <p><strong>æ´»å‹•åç¨±:</strong> ${result.event.eventName}</p>
                        <p><strong>å‰å°é€£çµ:</strong> <a href="/?event=${result.event.id}" target="_blank">/?event=${result.event.id}</a></p>
                        <pre>${JSON.stringify(result.event, null, 2)}</pre>`;
                } else {
                    resultDiv.innerHTML = `<h3>âŒ å¤±æ•—</h3><p>${result.message || result.error}</p>`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `<h3>âŒ éŒ¯èª¤</h3><p>${error.message}</p>`;
                document.getElementById('result').style.display = 'block';
            }
        }

        async function listEvents() {
            const secret = document.getElementById('adminSecret').value;
            
            try {
                const response = await fetch('/api/status', {
                    headers: {
                        'Authorization': `Bearer ${secret}`
                    }
                });

                const events = await response.json();
                const resultDiv = document.getElementById('result');
                resultDiv.style.display = 'block';
                
                if (response.ok) {
                    resultDiv.innerHTML = `<h3>ğŸ“‹ æ‰€æœ‰æ´»å‹•åˆ—è¡¨</h3>
                        <pre>${JSON.stringify(events, null, 2)}</pre>`;
                } else {
                    resultDiv.innerHTML = `<h3>âŒ å¤±æ•—</h3><p>${events.message || events.error}</p>`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `<h3>âŒ éŒ¯èª¤</h3><p>${error.message}</p>`;
                document.getElementById('result').style.display = 'block';
            }
        }
    </script>
</body>
</html>
