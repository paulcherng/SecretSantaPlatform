# 🔧 環境變數設定指南

## 錯誤訊息

如果你看到以下錯誤：
```
Missing credentials for "PLAIN"
```

這表示 Gmail 的認證資訊沒有正確設定。

## 必要的環境變數

在 Vercel 專案中，你需要設定以下環境變數：

### 1. ADMIN_SECRET
- **用途**：後台管理密碼
- **範例**：`my_super_secret_password_123`
- **如何設定**：可以是任何你想要的密碼

### 2. GMAIL_USER
- **用途**：用來寄送通知信的 Gmail 帳號
- **範例**：`your-email@gmail.com`
- **注意**：必須是完整的 Gmail 地址

### 3. GMAIL_APP_PASSWORD
- **用途**：Gmail 應用程式專用密碼（不是你的 Gmail 登入密碼！）
- **範例**：`abcd efgh ijkl mnop`（16 位數，有空格）
- **如何取得**：請看下方說明

### 4. KV_REST_API_URL
- **用途**：Vercel KV 資料庫連線網址
- **如何取得**：在 Vercel 專案中建立 KV 資料庫後自動產生

### 5. KV_REST_API_TOKEN
- **用途**：Vercel KV 資料庫認證 Token
- **如何取得**：在 Vercel 專案中建立 KV 資料庫後自動產生

## 如何取得 Gmail 應用程式密碼

### 步驟 1：啟用兩步驟驗證
1. 前往 https://myaccount.google.com/security
2. 找到「兩步驟驗證」
3. 如果尚未啟用，請先啟用

### 步驟 2：建立應用程式密碼
1. 前往 https://myaccount.google.com/apppasswords
2. 選擇「應用程式」→「郵件」
3. 選擇「裝置」→「其他（自訂名稱）」
4. 輸入名稱，例如：「Vercel 交換禮物系統」
5. 點擊「產生」
6. 複製產生的 16 位數密碼（格式：`xxxx xxxx xxxx xxxx`）


## 在 Vercel 設定環境變數

### 方法 1：透過 Vercel Dashboard

1. 登入 Vercel (https://vercel.com)
2. 選擇你的專案
3. 點擊「Settings」
4. 點擊左側選單的「Environment Variables」
5. 新增以下變數：

```
Name: ADMIN_SECRET
Value: [你的管理密碼]
Environment: Production, Preview, Development

Name: GMAIL_USER
Value: your-email@gmail.com
Environment: Production, Preview, Development

Name: GMAIL_APP_PASSWORD
Value: [你的 Gmail 應用程式密碼]
Environment: Production, Preview, Development
```

6. 點擊「Save」
7. **重新部署專案**（環境變數變更後需要重新部署才會生效）

### 方法 2：透過 Vercel CLI

```bash
vercel env add ADMIN_SECRET
vercel env add GMAIL_USER
vercel env add GMAIL_APP_PASSWORD
```

## 測試郵件功能

設定完成後，請按照以下步驟測試：

1. 重新部署專案（確保環境變數生效）
2. 建立一個測試活動
3. 填寫至少 2 個參與者
4. 執行抽籤
5. 點擊「📧 寄出魔法信件」
6. 檢查參與者的信箱

## 常見問題

### Q: 我已經設定環境變數，但還是出現錯誤？
A: 請確認：
- 環境變數名稱完全正確（區分大小寫）
- 已經重新部署專案
- Gmail 應用程式密碼是正確的（不是 Gmail 登入密碼）

### Q: 可以使用其他郵件服務嗎？
A: 可以！修改 `api/send-emails.js` 中的 transporter 設定即可。

### Q: 郵件會進入垃圾郵件嗎？
A: 可能會。建議：
- 使用正式的 Gmail 帳號
- 請參與者將寄件者加入通訊錄
- 測試時先檢查垃圾郵件資料夾

### Q: 可以一次寄給很多人嗎？
A: Gmail 有每日寄信限制：
- 一般帳號：每天 500 封
- Google Workspace：每天 2000 封

## 郵件內容預覽

寄出的郵件會包含：
- 🎄 活動名稱
- 💰 禮物金額
- 📅 活動時間（如果有設定）
- 📍 活動地點（如果有設定）
- ✨ 對方的願望內容
- 🤫 保密提醒

## 安全性建議

1. **不要將環境變數提交到 Git**
2. **定期更換 ADMIN_SECRET**
3. **使用專門的 Gmail 帳號**（不要用個人主要帳號）
4. **定期檢查 Vercel 專案的存取權限**
